<!DOCTYPE html>
<html lang="en">
<head>

<script>
    // Check if Gemini API is configured
    document.addEventListener('DOMContentLoaded', function() {
        // Check if any generate content buttons exist
        const generateButtons = document.querySelectorAll('.generate-content-btn');
        if (generateButtons.length > 0) {
            // Add tooltip to buttons
            generateButtons.forEach(button => {
                button.setAttribute('title', 'Requires Gemini API key to be configured');
            });

            // Check if we need to show API key notification
            fetch('/api/check_gemini_api')
                .then(response => response.json())
                .then(data => {
                    if (!data.configured) {
                        const alertDiv = document.createElement('div');
                        alertDiv.className = 'alert alert-warning alert-dismissible fade show mt-3';
                        alertDiv.innerHTML = `
                            <strong>Gemini API Key Required</strong> - Content generation requires a Google Gemini API key. 
                            Please add it as an environment variable named 'GEMINI_API_KEY' in the Secrets tab.
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        `;
                        document.querySelector('.content-preview').prepend(alertDiv);
                    }
                })
                .catch(err => console.error('Error checking API status:', err));
        }
    });
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Preview - WordPress Automation Tool</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <!-- Include Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        // Make the stripe key available to our scripts
        const stripePublishableKey = '{{ stripe_publishable_key if stripe_publishable_key else "pk_test_sample" }}';
        const currentUserPlan = "{{ session.get('subscription_plan', 'free') }}";
        
        // Debug info for Stripe integration
        console.log('Stripe publishable key loaded:', stripePublishableKey ? 'Yes' : 'No');
        console.log('Current user plan:', currentUserPlan);
    </script>
    <!-- Initialize content generation script with Stripe integration -->
    <script src="{{ url_for('static', filename='js/content_generation.js') }}" defer></script>
</head>
<body>
    {% include 'bubble_background.html' %}
    {% include 'header.html' %}
    <script src="{{ url_for('static', filename='js/progress.js') }}"></script>
    <div class="container mt-5" style="max-width: 1200px;">
        <div class="row justify-content-center">
            <div class="stage-container">
                <div class="pricing-card" style="background: rgba(255, 212, 239, 0.1);">
                    <h2 class="text-center mb-4">Stage 8: Content Preview</h2>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                        <div class="progress-text">Stage 8/10</div>
                    </div>

                    <!-- Initial Generated Content -->
                    <div class="content-preview p-3" style="max-width: 1000px; margin: 0 auto;">
                        <h3>Generated Content</h3>
                        {% if session.get('content_generated') %}
                            {% if session.get('subscription_plan', 'free') == 'free' %}
                                <div class="alert alert-info">
                                    <strong>Free Trial Content</strong>
                                    <p>This is your one-time free trial generated content. To generate more content, please subscribe to one of our premium plans.</p>
                                </div>
                            {% endif %}
                            <p>{{ session.get('generated_content', 'Welcome to our website! This is a sample of AI-generated content for your website. It will showcase your products or services in a professional manner that engages visitors and encourages them to explore more. Our AI-powered system creates unique, relevant content tailored to your specific website category and business needs.') }}</p>
                        {% else %}
                            <p>{{ generated_content }}</p>
                        {% endif %}

                        <h3>Image Description</h3>
                        {% if session.get('content_generated') %}
                            <p>{{ session.get('generated_image_description', 'A professional, high-quality image showing a modern, clean layout that represents your business. The image should include your brand colors and match the overall aesthetic of your website.') }}</p>
                        {% else %}
                            <p>{{ generated_image_description }}</p>
                        {% endif %}
                        
                        <!-- Content Generation Quick Tools -->
                        <div class="content-generation-tools mt-4 mb-4">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h4 class="mb-0">Quick Content Generation Tools</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <!-- Content Generation Form -->
                                            <form id="quick-content-form">
                                                <div class="mb-3">
                                                    <label for="content-type" class="form-label">Content Type</label>
                                                    <select class="form-select" id="content-type" name="content-type">
                                                        <option value="blog_post">Blog Post</option>
                                                        <option value="product_description">Product Description</option>
                                                        <option value="seo_meta">SEO Meta Description</option>
                                                        <option value="social_post">Social Media Post</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="content-topic" class="form-label">Topic/Keywords</label>
                                                    <input type="text" class="form-control" id="content-topic" placeholder="Enter topic or keywords">
                                                </div>
                                                <button type="button" id="generate-quick-content" class="btn btn-primary">
                                                    <i class="fas fa-magic me-2"></i>Generate Quick Content
                                                </button>
                                            </form>
                                            <div id="quick-content-result" class="mt-3"></div>
                                        </div>
                                        <div class="col-md-6">
                                            <!-- Subscription Usage Status -->
                                            <div class="subscription-usage-card p-3 border rounded">
                                                <h5 class="border-bottom pb-2 mb-3">Your Content Generation Quota</h5>
                                                
                                                {% if session.get('subscription_plan') == 'free' %}
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Blog Posts:</span>
                                                        <span class="badge bg-primary">0/1 remaining</span>
                                                    </div>
                                                    <div class="progress mb-3" style="height: 10px;">
                                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                {% elif session.get('subscription_plan') == 'basic' %}
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Blog Posts:</span>
                                                        <span class="badge bg-primary">1/2 remaining</span>
                                                    </div>
                                                    <div class="progress mb-3" style="height: 10px;">
                                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                {% elif session.get('subscription_plan') == 'professional' %}
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Blog Posts:</span>
                                                        <span class="badge bg-success">3/5 remaining</span>
                                                    </div>
                                                    <div class="progress mb-3" style="height: 10px;">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                {% elif session.get('subscription_plan') == 'premium' %}
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Blog Posts:</span>
                                                        <span class="badge bg-warning text-dark">12/15 remaining</span>
                                                    </div>
                                                    <div class="progress mb-3" style="height: 10px;">
                                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                {% else %}
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span>Blog Posts:</span>
                                                        <span class="badge bg-secondary">0/1 remaining</span>
                                                    </div>
                                                    <div class="progress mb-3" style="height: 10px;">
                                                        <div class="progress-bar bg-secondary" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                {% endif %}
                                                
                                                <div class="text-center mt-3">
                                                    <button class="btn btn-sm btn-outline-primary" id="refresh-quota">
                                                        <i class="fas fa-sync-alt me-1"></i> Refresh Quota
                                                    </button>
                                                </div>
                                                
                                                <div class="mt-3 small text-muted">
                                                    {{ session.get('subscription_plan', 'free')|capitalize }} plan limits: 
                                                    {% if session.get('subscription_plan') == 'free' %}
                                                        1 blog post, 1 image
                                                    {% elif session.get('subscription_plan') == 'basic' %}
                                                        2 blog posts, 5 images
                                                    {% elif session.get('subscription_plan') == 'professional' %}
                                                        5 blog posts, 15 images
                                                    {% elif session.get('subscription_plan') == 'premium' %}
                                                        15 blog posts, 30 images
                                                    {% else %}
                                                        1 blog post, 1 image
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Image Upload Section -->
                        <div class="media-upload-section mt-4">
                            <h4 class="mb-3">Upload Images for Media Library</h4>
                            <div class="card">
                                <div class="card-body">
                                    <p class="text-muted mb-3">
                                        {% if session.get('subscription_plan') == 'free' %}
                                            Your free plan allows uploading 1 image.
                                        {% elif session.get('subscription_plan') == 'basic' %}
                                            Your Basic plan allows uploading up to 5 images.
                                        {% elif session.get('subscription_plan') == 'professional' %}
                                            Your Professional plan allows uploading up to 15 images.
                                        {% elif session.get('subscription_plan') == 'premium' %}
                                            Your Premium plan allows uploading up to 30 images.
                                        {% else %}
                                            Your plan allows uploading 1 image.
                                        {% endif %}
                                    </p>
                                    <form id="image-upload-form" enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="wp-images" class="form-label">Select Images</label>
                                            <input class="form-control" type="file" id="wp-images" name="wp-images" 
                                                {% if session.get('subscription_plan') == 'free' %}
                                                    accept="image/*"
                                                {% else %}
                                                    accept="image/*" multiple
                                                {% endif %}
                                            >
                                            <div class="form-text">
                                                Supported formats: JPG, PNG, GIF, WebP (max 5MB per file)
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="alt-text" class="form-label">Alt Text</label>
                                            <input type="text" class="form-control" id="alt-text" name="alt-text" placeholder="Describe the image for accessibility">
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <button type="button" id="upload-images-btn" class="btn btn-primary">
                                                <i class="fas fa-upload me-2"></i>Upload to WordPress
                                            </button>
                                            <span id="image-count-display" class="text-muted align-self-center">
                                                No files selected
                                            </span>
                                        </div>
                                    </form>
                                    <div id="upload-progress" class="progress mt-3 d-none">
                                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div id="upload-result" class="mt-3"></div>
                                    <div id="uploaded-images-container" class="row mt-4 g-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- REDESIGNED: Content Generation Options Based on Plan -->
<div class="container mb-4 mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <div class="card content-generation-actions">
                <div class="card-body">
                    <h4 class="mb-3">Want to Generate More Content?</h4>
                    <p class="text-muted">You can return to the content generation page to create additional content based on your subscription plan.</p>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="/generate_content" class="btn btn-primary">
                            <i class="fas fa-magic me-2"></i>Generate More Content
                        </a>
                        <a href="/summary" class="btn btn-outline-primary">
                            <i class="fas fa-check-circle me-2"></i>Continue to Summary
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                    <div class="mt-4">
                        <h3 class="text-center">Generate Additional Content with AI</h3>
                        <p class="text-center">Select a subscription plan to generate more specialized content for your website</p>

                        {% set user_plan = session.get('subscription_plan', 'free') %}

                        <!-- Subscription Plan Selector Tabs -->
                        <ul class="nav nav-tabs justify-content-center mb-3" id="planTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">
                                    Basic Plan
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="professional-tab" data-bs-toggle="tab" data-bs-target="#professional" type="button" role="tab" aria-controls="professional" aria-selected="false">
                                    Professional Plan
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="premium-tab" data-bs-toggle="tab" data-bs-target="#premium" type="button" role="tab" aria-controls="premium" aria-selected="false">
                                    Premium Plan
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="planTabsContent">
                            <!-- Basic Plan Tab -->
                            <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h4 class="mb-0 text-center">Basic Plan Features</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>Included Content:</h5>
                                                <ul class="list-group mb-3">
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Blog Post
                                                        <span class="badge bg-primary rounded-pill">1</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        About Page Content
                                                        <span class="badge bg-primary rounded-pill">✓</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Contact Page Content
                                                        <span class="badge bg-primary rounded-pill">✓</span>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6 d-flex flex-column justify-content-center align-items-center">
                                                {% if user_plan != 'free' %}
                                                    <div id="basic-content-status" class="mb-3">
                                                        <div class="text-center mb-2">
                                                            <i class="fas fa-check-circle text-success fa-2x"></i>
                                                            <p>You have access to Basic Plan content</p>
                                                        </div>
                                                        <button id="generate-basic-content" class="btn btn-primary btn-lg generate-content-btn w-100" data-plan="basic" style="max-width: 250px;">
                                                            <i class="fas fa-magic me-2"></i>Generate Content
                                                        </button>
                                                    </div>
                                                {% else %}
                                                    <div class="text-center mb-3">
                                                        <i class="fas fa-lock text-muted fa-2x"></i>
                                                        <p>Subscribe to unlock Basic Plan content</p>
                                                    </div>
                                                    <button class="btn btn-outline-primary btn-lg subscribe-btn" data-plan="basic" data-price="9.99">
                                                        <i class="fas fa-crown me-2"></i>Subscribe Now ($9.99/month)
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <!-- Generated Content Display (initially hidden) -->
                                        <div id="basic-generated-content" class="mt-4 generated-content-container" style="display: none;">
                                            <h5>Generated Content:</h5>
                                            <div class="accordion" id="basicContentAccordion">
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="blogPostHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#blogPostContent" aria-expanded="false" aria-controls="blogPostContent">
                                                            Blog Post
                                                        </button>
                                                    </h2>
                                                    <div id="blogPostContent" class="accordion-collapse collapse" aria-labelledby="blogPostHeading" data-bs-parent="#basicContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="blog-post-content">
                                                                <!-- Blog post content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your blog post</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="aboutPageHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#aboutPageContent" aria-expanded="false" aria-controls="aboutPageContent">
                                                            About Page
                                                        </button>
                                                    </h2>
                                                    <div id="aboutPageContent" class="accordion-collapse collapse" aria-labelledby="aboutPageHeading" data-bs-parent="#basicContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="about-page-content">
                                                                <!-- About page content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your About page</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="contactPageHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#contactPageContent" aria-expanded="false" aria-controls="contactPageContent">
                                                            Contact Page
                                                        </button>
                                                    </h2>
                                                    <div id="contactPageContent" class="accordion-collapse collapse" aria-labelledby="contactPageHeading" data-bs-parent="#basicContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="contact-page-content">
                                                                <!-- Contact page content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your Contact page</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Plan Tab -->
                            <div class="tab-pane fade" id="professional" role="tabpanel" aria-labelledby="professional-tab">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h4 class="mb-0 text-center">Professional Plan Features</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>Included Content:</h5>
                                                <ul class="list-group mb-3">
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Blog Posts
                                                        <span class="badge bg-success rounded-pill">5</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Complete Page Content
                                                        <span class="badge bg-success rounded-pill">All Pages</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        SEO Optimized Content
                                                        <span class="badge bg-success rounded-pill">✓</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Social Media Content
                                                        <span class="badge bg-success rounded-pill">✓</span>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6 d-flex flex-column justify-content-center align-items-center">
                                                {% if user_plan in ['professional', 'premium'] %}
                                                    <div id="professional-content-status" class="mb-3">
                                                        <div class="text-center mb-2">
                                                            <i class="fas fa-check-circle text-success fa-2x"></i>
                                                            <p>You have access to Professional Plan content</p>
                                                        </div>
                                                        <button id="generate-professional-content" class="btn btn-success btn-lg generate-content-btn" data-plan="professional">
                                                            <i class="fas fa-magic me-2"></i>Generate Content
                                                        </button>
                                                    </div>
                                                {% else %}
                                                    <div class="text-center mb-3">
                                                        <i class="fas fa-lock text-muted fa-2x"></i>
                                                        <p>Subscribe to unlock Professional Plan content</p>
                                                    </div>
                                                    <button class="btn btn-outline-success btn-lg subscribe-btn" data-plan="professional" data-price="19.99">
                                                        <i class="fas fa-crown me-2"></i>Subscribe Now ($19.99/month)
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <!-- Generated Content Display (initially hidden) -->
                                        <div id="professional-generated-content" class="mt-4 generated-content-container" style="display: none;">
                                            <h5>Generated Content:</h5>
                                            <div class="accordion" id="professionalContentAccordion">
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="blogPostsHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#blogPostsContent" aria-expanded="false" aria-controls="blogPostsContent">
                                                            Blog Posts (5)
                                                        </button>
                                                    </h2>
                                                    <div id="blogPostsContent" class="accordion-collapse collapse" aria-labelledby="blogPostsHeading" data-bs-parent="#professionalContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="blog-posts-content">
                                                                <!-- Blog posts content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your blog posts</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="allPagesHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#allPagesContent" aria-expanded="false" aria-controls="allPagesContent">
                                                            All Pages Content
                                                        </button>
                                                    </h2>
                                                    <div id="allPagesContent" class="accordion-collapse collapse" aria-labelledby="allPagesHeading" data-bs-parent="#professionalContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="all-pages-content">
                                                                <!-- All pages content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create content for all your pages</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="seoContentHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#seoContentContent" aria-expanded="false" aria-controls="seoContentContent">
                                                            SEO Content
                                                        </button>
                                                    </h2>
                                                    <div id="seoContentContent" class="accordion-collapse collapse" aria-labelledby="seoContentHeading" data-bs-parent="#professionalContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="seo-content">
                                                                <!-- SEO content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your SEO content</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="socialMediaHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#socialMediaContent" aria-expanded="false" aria-controls="socialMediaContent">
                                                            Social Media Content
                                                        </button>
                                                    </h2>
                                                    <div id="socialMediaContent" class="accordion-collapse collapse" aria-labelledby="socialMediaHeading" data-bs-parent="#professionalContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="social-media-content">
                                                                <!-- Social media content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your social media content</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Premium Plan Tab -->
                            <div class="tab-pane fade" id="premium" role="tabpanel" aria-labelledby="premium-tab">
                                <div class="card">
                                    <div class="card-header bg-warning text-dark">
                                        <h4 class="mb-0 text-center">Premium Plan Features</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>Included Content:</h5>
                                                <ul class="list-group mb-3">
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Blog Posts
                                                        <span class="badge bg-warning text-dark rounded-pill">15</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Custom Content Templates
                                                        <span class="badge bg-warning text-dark rounded-pill">✓</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Multi-language Content
                                                        <span class="badge bg-warning text-dark rounded-pill">✓</span>
                                                    </li>
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        Advanced SEO Content
                                                        <span class="badge bg-warning text-dark rounded-pill">✓</span>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6 d-flex flex-column justify-content-center align-items-center">
                                                {% if user_plan == 'premium' %}
                                                    <div id="premium-content-status" class="mb-3">
                                                        <div class="text-center mb-2">
                                                            <i class="fas fa-check-circle text-success fa-2x"></i>
                                                            <p>You have access to Premium Plan content</p>
                                                        </div>
                                                        <button id="generate-premium-content" class="btn btn-warning text-dark btn-lg generate-content-btn" data-plan="premium">
                                                            <i class="fas fa-magic me-2"></i>Generate Content
                                                        </button>
                                                    </div>
                                                {% else %}
                                                    <div class="text-center mb-3">
                                                        <i class="fas fa-lock text-muted fa-2x"></i>
                                                        <p>Subscribe to unlock Premium Plan content</p>
                                                    </div>
                                                    <button class="btn btn-outline-warning text-dark btn-lg subscribe-btn" data-plan="premium" data-price="39.99">
                                                        <i class="fas fa-crown me-2"></i>Subscribe Now ($39.99/month)
                                                    </button>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <!-- Generated Content Display (initially hidden) -->
                                        <div id="premium-generated-content" class="mt-4 generated-content-container" style="display: none;">
                                            <h5>Generated Content:</h5>
                                            <div class="accordion" id="premiumContentAccordion">
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="premiumBlogPostsHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#premiumBlogPostsContent" aria-expanded="false" aria-controls="premiumBlogPostsContent">
                                                            Blog Posts (15)
                                                        </button>
                                                    </h2>
                                                    <div id="premiumBlogPostsContent" class="accordion-collapse collapse" aria-labelledby="premiumBlogPostsHeading" data-bs-parent="#premiumContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="premium-blog-posts-content">
                                                                <!-- Premium blog posts content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your premium blog posts</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="customTemplatesHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#customTemplatesContent" aria-expanded="false" aria-controls="customTemplatesContent">
                                                            Custom Content Templates
                                                        </button>
                                                    </h2>
                                                    <div id="customTemplatesContent" class="accordion-collapse collapse" aria-labelledby="customTemplatesHeading" data-bs-parent="#premiumContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="custom-templates-content">
                                                                <!-- Custom templates content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your custom templates</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="multiLanguageHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#multiLanguageContent" aria-expanded="false" aria-controls="multiLanguageContent">
                                                            Multi-language Content
                                                        </button>
                                                    </h2>
                                                    <div id="multiLanguageContent" class="accordion-collapse collapse" aria-labelledby="multiLanguageHeading" data-bs-parent="#premiumContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="multi-language-content">
                                                                <!-- Multi-language content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your multi-language content</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="advancedSEOHeading">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#advancedSEOContent" aria-expanded="false" aria-controls="advancedSEOContent">
                                                            Advanced SEO Content
                                                        </button>
                                                    </h2>
                                                    <div id="advancedSEOContent" class="accordion-collapse collapse" aria-labelledby="advancedSEOHeading" data-bs-parent="#premiumContentAccordion">
                                                        <div class="accordion-body">
                                                            <div class="advanced-seo-content">
                                                                <!-- Advanced SEO content will be inserted here -->
                                                                <p class="placeholder-text">Click "Generate Content" to create your advanced SEO content</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3" role="alert">
                        <i class="fas fa-info-circle"></i> The content will be published as a draft post on your WordPress site
                    </div>

                    <div class="alert mt-3" style="background-color: #ffebee; color: #d32f2f; border: 1px solid #ffcdd2;">
                        <i class="fas fa-image me-2"></i> Use this image description with your preferred AI image generation platform to create matching visuals for your content
                    </div>

                    
                    <div class="text-center mt-3 d-flex justify-content-center">
                        <a href="{{ url_for('optimization') }}" class="btn btn-primary me-2">Continue to Optimization</a>
                        <a href="{{ url_for('summary') }}" class="btn btn-success">View Summary</a>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        // All initialization is now handled in content_generation.js

        // Update UI based on subscription plan
        function updateUIForSubscription(plan) {
            // Highlight the current plan tab
            if (plan !== 'free') {
                try {
                    document.querySelector(`#${plan}-tab`).click();
                } catch (e) {
                    console.log('Could not activate plan tab: ', e);
                }
            }
        }

        // Handle content generation for a plan
        function generatePlanContent(plan) {
            const generateBtn = document.getElementById(`generate-${plan}-content`);
            if (generateBtn) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
            }

            fetch('/api/generate_plan_content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ plan: plan })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show the content container
                    document.getElementById(`${plan}-generated-content`).style.display = 'block';
                    // Get the content from the server
                    fetchGeneratedContent(plan);
                } else {
                    throw new Error(data.error || 'Could not generate content');
                }
            })
            .catch(error => {
                console.error('Error generating content:', error);
                if (generateBtn) {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Generate Content';

                    // Show error message
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'alert alert-danger mt-2';
                    errorMsg.innerHTML = `<i class="fas fa-exclamation-triangle me-2"></i>Error: ${error.message || 'Content generation failed'}`;
                    generateBtn.parentNode.appendChild(errorMsg);

                    // Auto-remove error after 5 seconds
                    setTimeout(() => {
                        errorMsg.remove();
                    }, 5000);
                }
            });
        }

        // Fetch generated content for a plan
        function fetchGeneratedContent(plan) {
            fetch(`/api/get_generated_content?plan=${plan}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayPlanContent(plan, data.content);
                } else {
                    throw new Error(data.error || 'No content available');
                }
            })
            .catch(error => {
                console.error('Error fetching content:', error);

                // Show placeholder text for error
                const contentElements = document.querySelectorAll(`#${plan}-generated-content .placeholder-text`);
                contentElements.forEach(el => {
                    el.textContent = 'Error loading content. Please try again.';
                    el.style.color = '#dc3545';
                });

                // Re-enable generate button
                const generateBtn = document.getElementById(`generate-${plan}-content`);
                if (generateBtn) {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<i class="fas fa-magic me-2"></i>Try Again';
                }
            });
        }

        // Display the content in the UI
        function displayPlanContent(plan, content) {
            // Re-enable generate button
            const generateBtn = document.getElementById(`generate-${plan}-content`);
            if (generateBtn) {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-sync-alt me-2"></i>Regenerate Content';
            }

            // Fill in content sections based on plan
            if (plan === 'basic') {
                if (content.blog_post) {
                    document.querySelector('.blog-post-content').innerHTML = 
                        `<h4>Blog Post</h4><div class="content-section">${content.blog_post}</div>`;
                }

                if (content.about_page) {
                    document.querySelector('.about-page-content').innerHTML = 
                        `<h4>About Page</h4><div class="content-section">${content.about_page}</div>`;
                }

                if (content.contact_page) {
                    document.querySelector('.contact-page-content').innerHTML = 
                        `<h4>Contact Page</h4><div class="content-section">${content.contact_page}</div>`;
                }
            } 
            else if (plan === 'professional') {
                // Handle professional plan content
                if (content.blog_posts && content.blog_posts.length) {
                    let blogHTML = '<h4>Blog Posts</h4>';
                    content.blog_posts.forEach((post, index) => {
                        blogHTML += `<div class="blog-post mb-3">
                            <h5>Blog Post ${index + 1}</h5>
                            <div class="content-section">${post}</div>
                        </div>`;
                    });
                    document.querySelector('.blog-posts-content').innerHTML = blogHTML;
                }

                if (content.all_pages) {
                    let pagesHTML = '<h4>Page Content</h4>';
                    for (const [pageName, pageContent] of Object.entries(content.all_pages)) {
                        pagesHTML += `<div class="page-content mb-3">
                            <h5>${pageName} Page</h5>
                            <div class="content-section">${pageContent}</div>
                        </div>`;
                    }
                    document.querySelector('.all-pages-content').innerHTML = pagesHTML;
                }

                // And so on for other professional content types...
            }
            else if (plan === 'premium') {
                // Handle premium plan content display
                // Similar to professional, with premium-specific sections
            }
        }
    </script>
    <script>
        function uploadImages() {
            const fileInput = document.getElementById('background_images');
            const files = fileInput.files;
            const uploadBtn = document.querySelector('.upload-btn');
            const originalBtnText = uploadBtn.innerHTML;

            if (files.length === 0) {
                alert('Please select files to upload');
                return;
            }

            // Show loading state
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Uploading...';

            // Add status indicator
            const statusDiv = document.createElement('div');
            statusDiv.className = 'alert alert-info mt-2';
            statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Uploading images...';
            fileInput.parentNode.parentNode.appendChild(statusDiv);

            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('background_images', files[i]);
            }

            fetch('/content_preview', {
                method: 'POST', 
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Reset button state
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = originalBtnText;

                // Update status message
                if (data.success) {
                    if (data.urls && data.urls.length > 0) {
                        statusDiv.className = 'alert alert-success mt-2';
                        statusDiv.innerHTML = `<i class="fas fa-check-circle me-2"></i>Images uploaded successfully: ${data.urls.length} images`;
                        fileInput.value = '';
                        console.log('Uploaded image URLs:', data.urls);
                    } else {
                        statusDiv.className = 'alert alert-warning mt-2';
                        statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>No images were uploaded. Please try again.';
                    }
                } else {
                    statusDiv.className = 'alert alert-danger mt-2';
                    statusDiv.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i>Error uploading images: ${data.error || 'Upload failed'}`;
                    console.error('Upload details:', data);
                }

                // Remove status message after 5 seconds
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.parentNode.removeChild(statusDiv);
                    }
                }, 5000);
            })
            .catch(error => {
                console.error('Error:', error);
                
                // Reset button state
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = originalBtnText;
                
                // Update status message
                statusDiv.className = 'alert alert-danger mt-2';
                statusDiv.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>An error occurred while uploading images';
                
                // Remove status message after 5 seconds
                setTimeout(() => {
                    if (statusDiv.parentNode) {
                        statusDiv.parentNode.removeChild(statusDiv);
                    }
                }, 5000);
            });
        }
    </script>
    {% include 'footer.html' %}
</body>
</html>